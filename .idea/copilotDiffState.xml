<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/antam/app/controller/dialog/SuaKhachHangController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/antam/app/controller/dialog/SuaKhachHangController.java" />
              <option name="updatedContent" value="/*&#10; * @ (#) SuaKhachHangController.java   1.0 28/10/25&#10; *&#10; * Copyright (c) 2025 IUH. All rights reserved.&#10; */&#10;package com.antam.app.controller.dialog;&#10;&#10;import com.antam.app.dao.KhachHang_DAO;&#10;import com.antam.app.entity.KhachHang;&#10;import javafx.fxml.FXML;&#10;import javafx.fxml.Initializable;&#10;import javafx.scene.control.Alert;&#10;import javafx.scene.control.Button;&#10;import javafx.scene.control.TextField;&#10;&#10;import java.net.URL;&#10;import java.util.ResourceBundle;&#10;&#10;/*&#10; * @description Controller for updating customer information&#10; * @author: Tran Tuan Hung&#10; * @date: 28/10/25&#10; * @version: 1.0&#10; */&#10;public class SuaKhachHangController implements Initializable {&#10;&#10;    @FXML&#10;    private TextField txtMaKhachHang;&#10;&#10;    @FXML&#10;    private TextField txtTenKhachHang;&#10;&#10;    @FXML&#10;    private TextField txtSoDienThoai;&#10;&#10;    @FXML&#10;    private Button btnLuu;&#10;&#10;    @FXML&#10;    private Button btnHuy;&#10;&#10;    private KhachHang khachHang;&#10;    private KhachHang_DAO khachHangDAO;&#10;&#10;    @Override&#10;    public void initialize(URL location, ResourceBundle resources) {&#10;        // Khởi tạo DAO&#10;        khachHangDAO = new KhachHang_DAO();&#10;&#10;        // Thiết lập sự kiện cho nút Lưu&#10;        btnLuu.setOnAction(event -&gt; handleLuu());&#10;&#10;        // Thiết lập sự kiện cho nút Hủy&#10;        btnHuy.setOnAction(event -&gt; handleHuy());&#10;    }&#10;&#10;    /**&#10;     * Thiết lập dữ liệu khách hàng để hiển thị trong form&#10;     */&#10;    public void setKhachHang(KhachHang kh) {&#10;        this.khachHang = kh;&#10;        if (khachHang != null) {&#10;            txtMaKhachHang.setText(khachHang.getMaKH());&#10;            txtTenKhachHang.setText(khachHang.getTenKH());&#10;            txtSoDienThoai.setText(khachHang.getSoDienThoai());&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Xử lý sự kiện click nút Lưu&#10;     */&#10;    private void handleLuu() {&#10;        // Kiểm tra dữ liệu đầu vào&#10;        if (txtTenKhachHang.getText().trim().isEmpty()) {&#10;            showError(&quot;Lỗi&quot;, &quot;Tên khách hàng không được để trống&quot;);&#10;            return;&#10;        }&#10;&#10;        if (txtSoDienThoai.getText().trim().isEmpty()) {&#10;            showError(&quot;Lỗi&quot;, &quot;Số điện thoại không được để trống&quot;);&#10;            return;&#10;        }&#10;&#10;        // Kiểm tra định dạng số điện thoại (đơn giản: chỉ chứa số)&#10;        if (!txtSoDienThoai.getText().matches(&quot;\\d+&quot;)) {&#10;            showError(&quot;Lỗi&quot;, &quot;Số điện thoại phải chỉ chứa các chữ số&quot;);&#10;            return;&#10;        }&#10;&#10;        try {&#10;            // Cập nhật thông tin khách hàng&#10;            khachHang.setTenKH(txtTenKhachHang.getText().trim());&#10;            khachHang.setSoDienThoai(txtSoDienThoai.getText().trim());&#10;&#10;            // Lưu vào database&#10;            boolean success = khachHangDAO.updateKhachHang(khachHang);&#10;&#10;            if (success) {&#10;                showInfo(&quot;Thành công&quot;, &quot;Cập nhật thông tin khách hàng thành công&quot;);&#10;                // Đóng dialog&#10;                btnHuy.getScene().getWindow().hide();&#10;            } else {&#10;                showError(&quot;Lỗi&quot;, &quot;Không thể cập nhật thông tin khách hàng&quot;);&#10;            }&#10;&#10;        } catch (Exception e) {&#10;            showError(&quot;Lỗi&quot;, &quot;Lỗi khi cập nhật: &quot; + e.getMessage());&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Xử lý sự kiện click nút Hủy&#10;     */&#10;    private void handleHuy() {&#10;        // Đóng dialog mà không lưu&#10;        btnHuy.getScene().getWindow().hide();&#10;    }&#10;&#10;    /**&#10;     * Hiển thị dialog lỗi&#10;     */&#10;    private void showError(String title, String message) {&#10;        Alert alert = new Alert(Alert.AlertType.ERROR);&#10;        alert.setTitle(title);&#10;        alert.setHeaderText(null);&#10;        alert.setContentText(message);&#10;        alert.showAndWait();&#10;    }&#10;&#10;    /**&#10;     * Hiển thị dialog thông tin&#10;     */&#10;    private void showInfo(String title, String message) {&#10;        Alert alert = new Alert(Alert.AlertType.INFORMATION);&#10;        alert.setTitle(title);&#10;        alert.setHeaderText(null);&#10;        alert.setContentText(message);&#10;        alert.showAndWait();&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/antam/app/controller/hoadon/ThongKeDoanhThuController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/antam/app/controller/hoadon/ThongKeDoanhThuController.java" />
              <option name="originalContent" value="package com.antam.app.controller.hoadon;&#10;&#10;import com.antam.app.dao.ThongKeDoanhThu_DAO;&#10;import com.antam.app.dao.ThongKeTrangChinh_DAO;&#10;import com.antam.app.entity.NhanVien;&#10;import com.antam.app.entity.ThongKeDoanhThu;&#10;import javafx.collections.FXCollections;&#10;import javafx.collections.ObservableList;&#10;import javafx.event.ActionEvent;&#10;import javafx.fxml.Initializable;&#10;import javafx.scene.Node;&#10;import javafx.scene.chart.BarChart;&#10;import javafx.scene.chart.LineChart;&#10;import javafx.scene.chart.XYChart;&#10;import javafx.scene.control.*;&#10;import javafx.scene.control.cell.PropertyValueFactory;&#10;import javafx.scene.text.Text;&#10;import javafx.stage.FileChooser;&#10;&#10;import java.io.File;&#10;import java.io.FileWriter;&#10;import java.io.IOException;&#10;import java.net.URL;&#10;import java.text.DecimalFormat;&#10;import java.time.LocalDate;&#10;import java.time.format.DateTimeFormatter;&#10;import java.util.ArrayList;&#10;import java.util.Map;&#10;import java.util.ResourceBundle;&#10;&#10;import de.jensd.fx.glyphs.fontawesome.FontAwesomeIcon;&#10;import javafx.geometry.Pos;&#10;import javafx.scene.chart.*;&#10;import javafx.scene.control.Button;&#10;import javafx.scene.control.Label;&#10;import javafx.scene.effect.DropShadow;&#10;import javafx.scene.layout.*;&#10;import javafx.scene.text.Font;&#10;import javafx.geometry.Insets;&#10;import javafx.scene.paint.Color;&#10;&#10;&#10;public class ThongKeDoanhThuController extends ScrollPane {&#10;&#10;     private Button btnXuatBaoCao;&#10;     private ComboBox&lt;String&gt; cmbThoiGian;&#10;     private ComboBox&lt;String&gt; cmbNhanVien;&#10;&#10;     private Text txtDoanhThuKy;&#10;     private Text txtSoDonHang;&#10;     private Text txtDonHangTB;&#10;     private Text txtSoKhachHang;&#10;&#10;     private Button btnDoanhThuChange;&#10;     private Button btnDonHangChange;&#10;     private Button btnDonHangTBChange;&#10;     private Button btnKhachHangChange;&#10;&#10;     private LineChart&lt;String, Number&gt; chartDoanhThu;&#10;     private BarChart&lt;String, Number&gt; chartTopSanPham;&#10;&#10;     private TableView&lt;ThongKeDoanhThu&gt; tableChiTiet;&#10;     private TableColumn&lt;ThongKeDoanhThu, LocalDate&gt; colNgay;&#10;     private TableColumn&lt;ThongKeDoanhThu, Integer&gt; colSoDonHang;&#10;     private TableColumn&lt;ThongKeDoanhThu, Double&gt; colDoanhThu;&#10;     private TableColumn&lt;ThongKeDoanhThu, Double&gt; colDonHangTB;&#10;     private TableColumn&lt;ThongKeDoanhThu, Integer&gt; colKhachHangMoi;&#10;     private TableColumn&lt;ThongKeDoanhThu, String&gt; colNhanVienBan;&#10;&#10;     private Button btnRefresh;&#10;&#10;    private ThongKeDoanhThu_DAO thongKeDAO;&#10;    private ThongKeTrangChinh_DAO thongKeTrangChinhDAO;&#10;    private LocalDate tuNgay;&#10;    private LocalDate denNgay;&#10;    private String selectedNhanVien = null;&#10;    private DecimalFormat formatter = new DecimalFormat(&quot;#,###&quot;);&#10;    private DecimalFormat percentFormatter = new DecimalFormat(&quot;#0.0&quot;);&#10;&#10;    public ThongKeDoanhThuController(){&#10;        this.setFitToHeight(true);&#10;        this.setFitToWidth(true);&#10;        this.setPrefSize(900, 730);&#10;        AnchorPane.setTopAnchor(this, 0.0);&#10;        AnchorPane.setBottomAnchor(this, 0.0);&#10;        AnchorPane.setLeftAnchor(this, 0.0);&#10;        AnchorPane.setRightAnchor(this, 0.0);&#10;&#10;        VBox root = new VBox(30);&#10;        root.setStyle(&quot;-fx-background-color: #f8fafc;&quot;);&#10;        setContent(root);&#10;&#10;        // ---------------------- HEADER ----------------------&#10;        HBox header = new HBox();&#10;        header.setAlignment(Pos.CENTER_LEFT);&#10;&#10;        Text title = new Text(&quot;Thống kê doanh thu&quot;);&#10;        title.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;        title.setFont(Font.font(&quot;System Bold&quot;, 30));&#10;&#10;        Region space = new Region();&#10;        HBox.setHgrow(space, Priority.ALWAYS);&#10;&#10;        btnXuatBaoCao = new Button(&quot;Xuất báo cáo&quot;);&#10;        btnXuatBaoCao.setPrefSize(120, 50);&#10;        btnXuatBaoCao.getStyleClass().add(&quot;btn-gray&quot;);&#10;        btnXuatBaoCao.setTextFill(Color.WHITE);&#10;&#10;        FontAwesomeIcon iconDownload = new FontAwesomeIcon();&#10;        iconDownload.setGlyphName(&quot;CLOUD_DOWNLOAD&quot;);&#10;        iconDownload.setFill(Color.WHITE);&#10;        btnXuatBaoCao.setGraphic(iconDownload);&#10;&#10;        header.getChildren().addAll(title, space, btnXuatBaoCao);&#10;&#10;        // ---------------------- FILTER PANE ----------------------&#10;        FlowPane filterPane = new FlowPane(5, 5);&#10;        filterPane.setPadding(new Insets(10));&#10;        filterPane.getStyleClass().add(&quot;box-pane&quot;);&#10;        filterPane.setEffect(new DropShadow(20, Color.rgb(211, 211, 211)));&#10;&#10;        // TIME COMBOBOX&#10;        VBox vbTime = new VBox(5);&#10;        Text txtTime = new Text(&quot;Thời gian:&quot;);&#10;        txtTime.setFill(Color.web(&quot;#374151&quot;));&#10;        cmbThoiGian = new ComboBox&lt;&gt;();&#10;        cmbThoiGian.setPrefSize(200, 40);&#10;        cmbThoiGian.getStyleClass().add(&quot;combo-box&quot;);&#10;&#10;        vbTime.getChildren().addAll(txtTime, cmbThoiGian);&#10;&#10;        // EMPLOYEE COMBOBOX&#10;        VBox vbNV = new VBox(5);&#10;        Text txtNV = new Text(&quot;Nhân viên:&quot;);&#10;        txtNV.setFill(Color.web(&quot;#374151&quot;));&#10;        cmbNhanVien = new ComboBox&lt;&gt;();&#10;        cmbNhanVien.setPrefSize(200, 40);&#10;        cmbNhanVien.getStyleClass().add(&quot;combo-box&quot;);&#10;&#10;        vbNV.getChildren().addAll(txtNV, cmbNhanVien);&#10;&#10;        filterPane.getChildren().addAll(vbTime, vbNV);&#10;&#10;        // ---------------------- STAT CARDS ----------------------&#10;        FlowPane cards = new FlowPane(30, 20);&#10;        cards.setAlignment(Pos.CENTER);&#10;&#10;        // Card 1 – DOANH THU KY&#10;        StackPane card1 = createCard(&#10;                &quot;#059669&quot;,&#10;                &quot;MONEY&quot;,&#10;                txtDoanhThuKy = new Text(&quot;0&quot;),&#10;                new Text(&quot;Doanh thu kỳ&quot;),&#10;                btnDoanhThuChange = new Button(&quot;0%&quot;)&#10;        );&#10;        // Card 2 – DON HANG&#10;        StackPane card2 = createCard(&#10;                &quot;#2563eb&quot;,&#10;                &quot;FILE&quot;,&#10;                txtSoDonHang = new Text(&quot;0&quot;),&#10;                new Text(&quot;Đơn hàng&quot;),&#10;                btnDonHangChange = new Button(&quot;0%&quot;)&#10;        );&#10;        // Card 3 – DON HANG TB&#10;        StackPane card3 = createCard(&#10;                &quot;#8b5cf6&quot;,&#10;                &quot;CALCULATOR&quot;,&#10;                txtDonHangTB = new Text(&quot;0&quot;),&#10;                new Text(&quot;Đơn hàng TB&quot;),&#10;                btnDonHangTBChange = new Button(&quot;0%&quot;)&#10;        );&#10;        // Card 4 – KHÁCH HÀNG&#10;        StackPane card4 = createCard(&#10;                &quot;#f59e0b&quot;,&#10;                &quot;USERS&quot;,&#10;                txtSoKhachHang = new Text(&quot;0&quot;),&#10;                new Text(&quot;Khách hàng&quot;),&#10;                btnKhachHangChange = new Button(&quot;0%&quot;)&#10;        );&#10;&#10;        cards.getChildren().addAll(card1, card2, card3, card4);&#10;&#10;        // ---------------------- CHARTS ----------------------&#10;        FlowPane charts = new FlowPane(20, 20);&#10;        charts.setAlignment(Pos.TOP_CENTER);&#10;&#10;        // LINE CHART&#10;        CategoryAxis x1 = new CategoryAxis();&#10;        NumberAxis y1 = new NumberAxis();&#10;        chartDoanhThu = new LineChart&lt;&gt;(x1, y1);&#10;&#10;        VBox vbChart1 = wrapChart(&quot;Doanh thu theo thời gian&quot;, chartDoanhThu);&#10;&#10;        // BAR CHART&#10;        CategoryAxis x2 = new CategoryAxis();&#10;        NumberAxis y2 = new NumberAxis();&#10;        chartTopSanPham = new BarChart&lt;&gt;(x2, y2);&#10;&#10;        VBox vbChart2 = wrapChart(&quot;Top sản phẩm bán chạy&quot;, chartTopSanPham);&#10;        charts.getChildren().addAll(vbChart1, vbChart2);&#10;&#10;        // ---------------------- TABLE ----------------------&#10;        AnchorPane tablePane = new AnchorPane();&#10;        tablePane.getStyleClass().add(&quot;box-pane&quot;);&#10;&#10;        VBox vbTable = new VBox(5);&#10;        vbTable.setPadding(new Insets(5));&#10;&#10;        HBox tbHeader = new HBox();&#10;        Text tbTitle = new Text(&quot;Chi tiết doanh thu&quot;);&#10;        tbTitle.setFont(Font.font(&quot;System Bold&quot;, 20));&#10;        tbTitle.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;&#10;        Region tbSpace = new Region();&#10;        HBox.setHgrow(tbSpace, Priority.ALWAYS);&#10;&#10;        btnRefresh = new Button();&#10;        btnRefresh.setPrefSize(50, 40);&#10;        btnRefresh.setStyle(&quot;-fx-background-color: #6b7280; -fx-border-radius: 8px;&quot;);&#10;&#10;        FontAwesomeIcon refreshIcon = new FontAwesomeIcon();&#10;        refreshIcon.setGlyphName(&quot;REFRESH&quot;);&#10;        refreshIcon.setFill(Color.WHITE);&#10;        btnRefresh.setGraphic(refreshIcon);&#10;&#10;        tbHeader.getChildren().addAll(tbTitle, tbSpace, btnRefresh);&#10;&#10;        // TableView&#10;        tableChiTiet = new TableView&lt;&gt;();&#10;        tableChiTiet.setPrefHeight(500);&#10;&#10;        colNgay = new TableColumn&lt;&gt;(&quot;Ngày&quot;);&#10;        colSoDonHang = new TableColumn&lt;&gt;(&quot;Số đơn hàng&quot;);&#10;        colDoanhThu = new TableColumn&lt;&gt;(&quot;Doanh thu&quot;);&#10;        colDonHangTB = new TableColumn&lt;&gt;(&quot;Đơn hàng TB&quot;);&#10;        colKhachHangMoi = new TableColumn&lt;&gt;(&quot;Khách hàng mới&quot;);&#10;        colNhanVienBan = new TableColumn&lt;&gt;(&quot;Nhân viên bán&quot;);&#10;&#10;        tableChiTiet.getColumns().addAll(&#10;                colNgay, colSoDonHang, colDoanhThu,&#10;                colDonHangTB, colKhachHangMoi, colNhanVienBan&#10;        );&#10;&#10;        vbTable.getChildren().addAll(tbHeader, tableChiTiet);&#10;&#10;        AnchorPane.setLeftAnchor(vbTable, 0.0);&#10;        AnchorPane.setRightAnchor(vbTable, 0.0);&#10;        tablePane.getChildren().add(vbTable);&#10;&#10;        // ---------------- ADD ALL ----------------&#10;        root.setPadding(new Insets(20));&#10;        root.getChildren().addAll(header, filterPane, cards, charts, tablePane);&#10;        this.getStylesheets().add(getClass().getResource(&quot;/com/antam/app/styles/dashboard_style.css&quot;).toExternalForm());&#10;        this.getChildren().add(root);&#10;&#10;        /** Sự kiện **/&#10;        thongKeDAO = new ThongKeDoanhThu_DAO();&#10;        thongKeTrangChinhDAO = new ThongKeTrangChinh_DAO();&#10;&#10;        // Khởi tạo ComboBox thời gian&#10;        cmbThoiGian.setItems(FXCollections.observableArrayList(&#10;                &quot;Hôm nay&quot;, &quot;7 ngày qua&quot;, &quot;30 ngày qua&quot;, &quot;Tháng này&quot;, &quot;Tháng trước&quot;, &quot;Năm nay&quot;&#10;        ));&#10;        cmbThoiGian.setValue(&quot;7 ngày qua&quot;);&#10;&#10;        // Load danh sách nhân viên&#10;        loadDanhSachNhanVien();&#10;&#10;        // Khởi tạo bảng&#10;        setupTableView();&#10;&#10;        // Tính thời gian mặc định&#10;        calculateDefaultTimeRange();&#10;&#10;        // Load dữ liệu&#10;        loadData();&#10;        btnRefresh.setOnAction(e-&gt;refreshData());&#10;        btnXuatBaoCao.setOnAction(e-&gt;xuatBaoCao());&#10;&#10;    }&#10;&#10;    private StackPane createCard(String color, String icon, Text bigText, Text label, Button changeBtn) {&#10;&#10;        StackPane card = new StackPane();&#10;        card.setPrefSize(250, 121);&#10;        card.setStyle(&quot;-fx-background-color: white; -fx-background-radius: 20px;&quot;);&#10;        card.setEffect(new DropShadow(10, Color.rgb(212, 212, 212)));&#10;&#10;        HBox box = new HBox(10);&#10;        box.setAlignment(Pos.CENTER_LEFT);&#10;        box.setPadding(new Insets(0, 20, 0, 20));&#10;&#10;        Button iconBtn = new Button();&#10;        iconBtn.setPrefSize(60, 60);&#10;        iconBtn.setStyle(&quot;-fx-background-color: &quot; + color + &quot;; -fx-background-radius: 15px;&quot;);&#10;&#10;        FontAwesomeIcon iconNode = new FontAwesomeIcon();&#10;        iconNode.setGlyphName(icon);&#10;        iconNode.setFill(Color.WHITE);&#10;        iconNode.setSize(&quot;2em&quot;);&#10;        iconBtn.setGraphic(iconNode);&#10;&#10;        VBox texts = new VBox();&#10;        texts.setPrefHeight(60);&#10;        texts.setAlignment(Pos.CENTER_LEFT);&#10;        bigText.setFont(Font.font(&quot;System Bold&quot;, 32));&#10;        bigText.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;&#10;        label.setFill(Color.web(&quot;#64748b&quot;));&#10;        changeBtn.setStyle(&quot;-fx-background-radius: 50px;&quot;);&#10;&#10;        texts.getChildren().addAll(bigText, label, changeBtn);&#10;&#10;        box.getChildren().addAll(iconBtn, texts);&#10;        card.getChildren().add(box);&#10;&#10;        return card;&#10;    }&#10;&#10;    // ---------------------------------------------------------&#10;    //  HELPER: tạo chart wrapper box-pane&#10;    // ---------------------------------------------------------&#10;    private VBox wrapChart(String titleStr, Node chart) {&#10;        VBox box = new VBox(10);&#10;        box.setPrefWidth(500);&#10;        box.setPadding(new Insets(10));&#10;        box.getStyleClass().add(&quot;box-pane&quot;);&#10;        box.setEffect(new DropShadow(12, Color.rgb(218, 218, 218)));&#10;&#10;        Text title = new Text(titleStr);&#10;        title.setFont(Font.font(&quot;System Bold&quot;, 20));&#10;        title.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;&#10;        box.getChildren().addAll(title, chart);&#10;        return box;&#10;    }&#10;&#10;    private void setupTableView() {&#10;        // Thêm placeholder cho bảng khi không có dữ liệu&#10;        Label placeholderLabel = new Label(&quot;Không có dữ liệu&quot;);&#10;        placeholderLabel.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #64748b;&quot;);&#10;        tableChiTiet.setPlaceholder(placeholderLabel);&#10;&#10;        colNgay.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;ngay&quot;));&#10;        colNgay.setCellFactory(column -&gt; new TableCell&lt;ThongKeDoanhThu, LocalDate&gt;() {&#10;            @Override&#10;            protected void updateItem(LocalDate item, boolean empty) {&#10;                super.updateItem(item, empty);&#10;                if (empty || item == null) {&#10;                    setText(null);&#10;                } else {&#10;                    setText(item.format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;)));&#10;                }&#10;            }&#10;        });&#10;&#10;        colSoDonHang.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;soDonHang&quot;));&#10;&#10;        colDoanhThu.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;doanhThu&quot;));&#10;        colDoanhThu.setCellFactory(column -&gt; new TableCell&lt;ThongKeDoanhThu, Double&gt;() {&#10;            @Override&#10;            protected void updateItem(Double item, boolean empty) {&#10;                super.updateItem(item, empty);&#10;                if (empty || item == null) {&#10;                    setText(null);&#10;                } else {&#10;                    setText(formatter.format(item) + &quot; đ&quot;);&#10;                }&#10;            }&#10;        });&#10;&#10;        colDonHangTB.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;donHangTB&quot;));&#10;        colDonHangTB.setCellFactory(column -&gt; new TableCell&lt;ThongKeDoanhThu, Double&gt;() {&#10;            @Override&#10;            protected void updateItem(Double item, boolean empty) {&#10;                super.updateItem(item, empty);&#10;                if (empty || item == null) {&#10;                    setText(null);&#10;                } else {&#10;                    setText(formatter.format(item) + &quot; đ&quot;);&#10;                }&#10;            }&#10;        });&#10;&#10;        colKhachHangMoi.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;khachHangMoi&quot;));&#10;        colNhanVienBan.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;nhanVienBan&quot;));&#10;    }&#10;&#10;    private void loadDanhSachNhanVien() {&#10;        ArrayList&lt;NhanVien&gt; dsNhanVien = thongKeDAO.getDanhSachNhanVien();&#10;        ObservableList&lt;String&gt; items = FXCollections.observableArrayList(&quot;Tất cả&quot;);&#10;        for (NhanVien nv : dsNhanVien) {&#10;            items.add(nv.getMaNV() + &quot; - &quot; + nv.getHoTen());&#10;        }&#10;        cmbNhanVien.setItems(items);&#10;        cmbNhanVien.setValue(&quot;Tất cả&quot;);&#10;    }&#10;&#10;    private void calculateDefaultTimeRange() {&#10;        String thoiGian = cmbThoiGian.getValue();&#10;        denNgay = LocalDate.now();&#10;&#10;        switch (thoiGian) {&#10;            case &quot;Hôm nay&quot;:&#10;                tuNgay = LocalDate.now();&#10;                break;&#10;            case &quot;7 ngày qua&quot;:&#10;                tuNgay = LocalDate.now().minusDays(6);&#10;                break;&#10;            case &quot;30 ngày qua&quot;:&#10;                tuNgay = LocalDate.now().minusDays(29);&#10;                break;&#10;            case &quot;Tháng này&quot;:&#10;                tuNgay = LocalDate.now().withDayOfMonth(1);&#10;                break;&#10;            case &quot;Tháng trước&quot;:&#10;                tuNgay = LocalDate.now().minusMonths(1).withDayOfMonth(1);&#10;                denNgay = LocalDate.now().withDayOfMonth(1).minusDays(1);&#10;                break;&#10;            case &quot;Năm nay&quot;:&#10;                tuNgay = LocalDate.now().withDayOfYear(1);&#10;                break;&#10;            default:&#10;                tuNgay = LocalDate.now().minusDays(6);&#10;        }&#10;    }&#10;&#10;    &#10;    private void locTheoThoiGian(ActionEvent event) {&#10;        calculateDefaultTimeRange();&#10;        loadData();&#10;    }&#10;&#10;    &#10;    private void locTheoNhanVien(ActionEvent event) {&#10;        String selected = cmbNhanVien.getValue();&#10;        if (selected != null &amp;&amp; !selected.equals(&quot;Tất cả&quot;)) {&#10;            selectedNhanVien = selected.split(&quot; - &quot;)[0];&#10;        } else {&#10;            selectedNhanVien = null;&#10;        }&#10;        loadData();&#10;    }&#10;&#10;    &#10;    private void refreshData() {&#10;        loadData();&#10;    }&#10;&#10;    private void loadData() {&#10;        // Load dữ liệu tổng quan&#10;        loadTongQuan();&#10;&#10;        // Load biểu đồ&#10;        loadChartDoanhThu();&#10;        loadTopProductsChart();&#10;&#10;        // Load bảng chi tiết&#10;        loadTableData();&#10;    }&#10;&#10;    private void loadTongQuan() {&#10;        double tongDoanhThu = thongKeDAO.getTongDoanhThu(tuNgay, denNgay, selectedNhanVien);&#10;        int tongDonHang = thongKeDAO.getTongDonHang(tuNgay, denNgay, selectedNhanVien);&#10;        int soKhachHang = thongKeDAO.getSoKhachHangMoi(tuNgay, denNgay, selectedNhanVien);&#10;        double donHangTB = tongDonHang &gt; 0 ? tongDoanhThu / tongDonHang : 0;&#10;&#10;        // Cập nhật text&#10;        txtDoanhThuKy.setText(formatCurrency(tongDoanhThu));&#10;        txtSoDonHang.setText(String.valueOf(tongDonHang));&#10;        txtDonHangTB.setText(formatCurrency(donHangTB));&#10;        txtSoKhachHang.setText(String.valueOf(soKhachHang));&#10;&#10;        // Tính % thay đổi so với kỳ trước (đơn giản hóa - có thể cải thiện)&#10;        calculateChange();&#10;    }&#10;&#10;    /*&#10;    * Tính phần trăm thay đổi so với kỳ trước và cập nhật nút tương ứng&#10;    * */&#10;    private void calculateChange() {&#10;        // Tính kỳ trước&#10;        long days = java.time.temporal.ChronoUnit.DAYS.between(tuNgay, denNgay) + 1;&#10;        LocalDate tuNgayTruoc = tuNgay.minusDays(days);&#10;        LocalDate denNgayTruoc = denNgay.minusDays(days);&#10;&#10;        double doanhThuHienTai = thongKeDAO.getTongDoanhThu(tuNgay, denNgay, selectedNhanVien);&#10;        double doanhThuTruoc = thongKeDAO.getTongDoanhThu(tuNgayTruoc, denNgayTruoc, selectedNhanVien);&#10;&#10;        int donHangHienTai = thongKeDAO.getTongDonHang(tuNgay, denNgay, selectedNhanVien);&#10;        int donHangTruoc = thongKeDAO.getTongDonHang(tuNgayTruoc, denNgayTruoc, selectedNhanVien);&#10;&#10;        int khachHangHienTai = thongKeDAO.getSoKhachHangMoi(tuNgay, denNgay, selectedNhanVien);&#10;        int khachHangTruoc = thongKeDAO.getSoKhachHangMoi(tuNgayTruoc, denNgayTruoc, selectedNhanVien);&#10;&#10;        updateChangeButton(btnDoanhThuChange, doanhThuHienTai, doanhThuTruoc);&#10;        updateChangeButton(btnDonHangChange, donHangHienTai, donHangTruoc);&#10;        updateChangeButton(btnDonHangTBChange,&#10;            donHangHienTai &gt; 0 ? doanhThuHienTai / donHangHienTai : 0,&#10;            donHangTruoc &gt; 0 ? doanhThuTruoc / donHangTruoc : 0);&#10;        updateChangeButton(btnKhachHangChange, khachHangHienTai, khachHangTruoc);&#10;    }&#10;&#10;    /*&#10;    *  Cập nhật nút thay đổi với phần trăm và màu sắc tương ứng&#10;    * */&#10;    private void updateChangeButton(Button btn, double current, double previous) {&#10;        if (previous == 0) {&#10;            btn.setText(&quot;N/A&quot;);&#10;            return;&#10;        }&#10;&#10;        double change = ((current - previous) / previous) * 100;&#10;        String text = (change &gt;= 0 ? &quot;+&quot; : &quot;&quot;) + percentFormatter.format(change) + &quot;%&quot;;&#10;        btn.setText(text);&#10;&#10;        if (change &gt;= 0) {&#10;            btn.setStyle(&quot;-fx-background-color: #d1fae5; -fx-text-fill: #059669; -fx-background-radius: 50px;&quot;);&#10;        } else {&#10;            btn.setStyle(&quot;-fx-background-color: #fee2e2; -fx-text-fill: #dc2626; -fx-background-radius: 50px;&quot;);&#10;        }&#10;    }&#10;&#10;    private void loadChartDoanhThu() {&#10;        chartDoanhThu.getData().clear();&#10;&#10;        // Kiểm tra xem có phải hiển thị theo tháng không (cho khoảng thời gian dài như năm)&#10;        String thoiGian = cmbThoiGian.getValue();&#10;        boolean hienThiTheoThang = &quot;Năm nay&quot;.equals(thoiGian);&#10;&#10;        ArrayList&lt;ThongKeDoanhThu&gt; dsThongKe;&#10;        if (hienThiTheoThang) {&#10;            // Lấy dữ liệu theo tháng&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThang(tuNgay, denNgay, selectedNhanVien);&#10;        } else {&#10;            // Lấy dữ liệu theo ngày&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThoiGian(tuNgay, denNgay, selectedNhanVien);&#10;        }&#10;&#10;        XYChart.Series&lt;String, Number&gt; series = new XYChart.Series&lt;&gt;();&#10;        series.setName(&quot;Doanh thu&quot;);&#10;&#10;        DateTimeFormatter dateFormatter = hienThiTheoThang&#10;            ? DateTimeFormatter.ofPattern(&quot;MM/yyyy&quot;)&#10;            : DateTimeFormatter.ofPattern(&quot;dd/MM&quot;);&#10;        DateTimeFormatter fullDateFormatter = hienThiTheoThang&#10;            ? DateTimeFormatter.ofPattern(&quot;'Tháng' MM/yyyy&quot;)&#10;            : DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);&#10;&#10;        if (hienThiTheoThang) {&#10;            // Hiển thị theo tháng - không cần tạo đầy đủ các tháng trống&#10;            Map&lt;String, ThongKeDoanhThu&gt; displayMap = new java.util.LinkedHashMap&lt;&gt;();&#10;&#10;            for (ThongKeDoanhThu tk : dsThongKe) {&#10;                String shortDate = tk.getNgay().format(dateFormatter);&#10;                displayMap.put(shortDate, tk);&#10;                series.getData().add(new XYChart.Data&lt;&gt;(shortDate, tk.getDoanhThu()));&#10;            }&#10;&#10;            chartDoanhThu.getData().add(series);&#10;&#10;            // Thêm tooltip cho từng điểm dữ liệu&#10;            for (XYChart.Data&lt;String, Number&gt; data : series.getData()) {&#10;                ThongKeDoanhThu tk = displayMap.get(data.getXValue());&#10;                if (tk != null) {&#10;                    Tooltip tooltip = new Tooltip(&#10;                        tk.getNgay().format(fullDateFormatter) + &quot;\n&quot; +&#10;                        &quot;Doanh thu: &quot; + formatter.format(data.getYValue().doubleValue()) + &quot; đ\n&quot; +&#10;                        &quot;Số đơn hàng: &quot; + tk.getSoDonHang() + &quot;\n&quot; +&#10;                        &quot;Đơn hàng TB: &quot; + formatter.format(tk.getDonHangTB()) + &quot; đ\n&quot; +&#10;                        &quot;Khách hàng: &quot; + tk.getKhachHangMoi()&#10;                    );&#10;&#10;                    tooltip.setShowDelay(javafx.util.Duration.millis(100));&#10;                    tooltip.setStyle(&#10;                        &quot;-fx-font-size: 12px; &quot; +&#10;                        &quot;-fx-background-color: rgba(30, 58, 138, 0.95); &quot; +&#10;                        &quot;-fx-text-fill: white; &quot; +&#10;                        &quot;-fx-padding: 8px; &quot; +&#10;                        &quot;-fx-background-radius: 6px;&quot;&#10;                    );&#10;&#10;                    javafx.scene.Node node = data.getNode();&#10;                    if (node != null) {&#10;                        Tooltip.install(node, tooltip);&#10;&#10;                        node.setOnMouseEntered(e -&gt; {&#10;                            node.setStyle(&#10;                                &quot;-fx-cursor: hand; &quot; +&#10;                                &quot;-fx-background-color: #059669; &quot; +&#10;                                &quot;-fx-background-radius: 8px;&quot;&#10;                            );&#10;                            node.setScaleX(1.5);&#10;                            node.setScaleY(1.5);&#10;                        });&#10;                        node.setOnMouseExited(e -&gt; {&#10;                            node.setStyle(&quot;&quot;);&#10;                            node.setScaleX(1.0);&#10;                            node.setScaleY(1.0);&#10;                        });&#10;                    }&#10;                }&#10;            }&#10;        } else {&#10;            // Hiển thị theo ngày - tạo đầy đủ các ngày&#10;            Map&lt;LocalDate, ThongKeDoanhThu&gt; dataMap = new java.util.HashMap&lt;&gt;();&#10;            for (ThongKeDoanhThu tk : dsThongKe) {&#10;                dataMap.put(tk.getNgay(), tk);&#10;            }&#10;&#10;            Map&lt;String, ThongKeDoanhThu&gt; displayMap = new java.util.LinkedHashMap&lt;&gt;();&#10;&#10;            LocalDate currentDate = tuNgay;&#10;            while (!currentDate.isAfter(denNgay)) {&#10;                ThongKeDoanhThu tk = dataMap.get(currentDate);&#10;&#10;                if (tk == null) {&#10;                    tk = new ThongKeDoanhThu(currentDate, 0, 0.0, 0.0, 0, &quot;&quot;);&#10;                }&#10;&#10;                String shortDate = currentDate.format(dateFormatter);&#10;                displayMap.put(shortDate, tk);&#10;                series.getData().add(new XYChart.Data&lt;&gt;(shortDate, tk.getDoanhThu()));&#10;&#10;                currentDate = currentDate.plusDays(1);&#10;            }&#10;&#10;            chartDoanhThu.getData().add(series);&#10;&#10;            // Thêm tooltip cho từng điểm dữ liệu&#10;            for (XYChart.Data&lt;String, Number&gt; data : series.getData()) {&#10;                ThongKeDoanhThu tk = displayMap.get(data.getXValue());&#10;                if (tk != null) {&#10;                    Tooltip tooltip = new Tooltip(&#10;                        &quot;Ngày: &quot; + tk.getNgay().format(fullDateFormatter) + &quot;\n&quot; +&#10;                        &quot;Doanh thu: &quot; + formatter.format(data.getYValue().doubleValue()) + &quot; đ\n&quot; +&#10;                        &quot;Số đơn hàng: &quot; + tk.getSoDonHang() + &quot;\n&quot; +&#10;                        &quot;Đơn hàng TB: &quot; + formatter.format(tk.getDonHangTB()) + &quot; đ\n&quot; +&#10;                        &quot;Khách hàng: &quot; + tk.getKhachHangMoi()&#10;                    );&#10;&#10;                    tooltip.setShowDelay(javafx.util.Duration.millis(100));&#10;                    tooltip.setStyle(&#10;                        &quot;-fx-font-size: 12px; &quot; +&#10;                        &quot;-fx-background-color: rgba(30, 58, 138, 0.95); &quot; +&#10;                        &quot;-fx-text-fill: white; &quot; +&#10;                        &quot;-fx-padding: 8px; &quot; +&#10;                        &quot;-fx-background-radius: 6px;&quot;&#10;                    );&#10;&#10;                    javafx.scene.Node node = data.getNode();&#10;                    if (node != null) {&#10;                        Tooltip.install(node, tooltip);&#10;&#10;                        node.setOnMouseEntered(e -&gt; {&#10;                            node.setStyle(&#10;                                &quot;-fx-cursor: hand; &quot; +&#10;                                &quot;-fx-background-color: #059669; &quot; +&#10;                                &quot;-fx-background-radius: 8px;&quot;&#10;                            );&#10;                            node.setScaleX(1.5);&#10;                            node.setScaleY(1.5);&#10;                        });&#10;                        node.setOnMouseExited(e -&gt; {&#10;                            node.setStyle(&quot;&quot;);&#10;                            node.setScaleX(1.0);&#10;                            node.setScaleY(1.0);&#10;                        });&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Tùy chỉnh style cho LineChart&#10;        chartDoanhThu.setCreateSymbols(true);&#10;        chartDoanhThu.setLegendVisible(true);&#10;    }&#10;&#10;    /**&#10;     * ==================== BIỂU ĐỒ TOP SẢN PHẨM ====================&#10;     * Load biểu đồ top sản phẩm bán chạy&#10;     */&#10;    private void loadTopProductsChart() {&#10;        if (chartTopSanPham == null) return;&#10;&#10;        try {&#10;            // *** CHỈNH SỐ SẢN PHẨM: Thay đổi số 5 để hiển thị nhiều/ít sản phẩm hơn ***&#10;            Map&lt;String, Integer&gt; topProducts = thongKeTrangChinhDAO.getTopSanPhamBanChay(5);&#10;&#10;            XYChart.Series&lt;String, Number&gt; series = new XYChart.Series&lt;&gt;();&#10;            series.setName(&quot;Số lượng bán&quot;);&#10;&#10;            // Map để lưu tên đầy đủ của thuốc&#10;            Map&lt;String, String&gt; fullNamesMap = new java.util.HashMap&lt;&gt;();&#10;&#10;            for (Map.Entry&lt;String, Integer&gt; entry : topProducts.entrySet()) {&#10;                String tenThuocDayDu = entry.getKey();&#10;                String tenThuoc = tenThuocDayDu;&#10;&#10;                // *** CHỈNH ĐỘ DÀI TÊN: Thay đổi số 15 (độ dài tối đa) và 12 (độ dài cắt) ***&#10;                // Rút ngắn tên thuốc nếu quá dài&#10;                if (tenThuoc.length() &gt; 15) {&#10;                    tenThuoc = tenThuoc.substring(0, 12) + &quot;...&quot;;&#10;                }&#10;&#10;                // Lưu tên đầy đủ&#10;                fullNamesMap.put(tenThuoc, tenThuocDayDu);&#10;&#10;                XYChart.Data&lt;String, Number&gt; data = new XYChart.Data&lt;&gt;(tenThuoc, entry.getValue());&#10;                series.getData().add(data);&#10;            }&#10;&#10;            chartTopSanPham.getData().clear();&#10;            chartTopSanPham.getData().add(series);&#10;&#10;            // Thêm tooltip cho từng thanh trong biểu đồ&#10;            for (XYChart.Data&lt;String, Number&gt; data : series.getData()) {&#10;                String tenThuocHienThi = data.getXValue();&#10;                String tenThuocDayDu = fullNamesMap.getOrDefault(tenThuocHienThi, tenThuocHienThi);&#10;                int soLuong = data.getYValue().intValue();&#10;&#10;                javafx.scene.control.Tooltip tooltip = new javafx.scene.control.Tooltip(&#10;                        &quot;Thuốc: &quot; + tenThuocDayDu + &quot;\n&quot; +&#10;                                &quot;Số lượng bán: &quot; + formatter.format(soLuong)&#10;                );&#10;&#10;                // *** CHỈNH MÀU TOOLTIP: Thay đổi màu nền và màu chữ ***&#10;                tooltip.setShowDelay(javafx.util.Duration.millis(100));&#10;                tooltip.setStyle(&#10;                        &quot;-fx-font-size: 12px; &quot; +&#10;                                &quot;-fx-background-color: #1e3a8a; &quot; +    // Màu nền tooltip (xanh lá)&#10;                                &quot;-fx-text-fill: white;&quot;                 // Màu chữ tooltip (trắng)&#10;                );&#10;&#10;                // Gắn tooltip vào node của data point (thanh)&#10;                javafx.scene.Node node = data.getNode();&#10;                if (node != null) {&#10;                    javafx.scene.control.Tooltip.install(node, tooltip);&#10;&#10;                    // *** CHỈNH HIỆU ỨNG HOVER: Thay đổi độ mờ khi rê chuột ***&#10;                    node.setOnMouseEntered(e -&gt; {&#10;                        node.setStyle(&#10;                                &quot;-fx-cursor: hand; &quot; +&#10;                                        &quot;-fx-opacity: 0.8;&quot;             // Độ mờ khi hover (0.0 - 1.0)&#10;                        );&#10;                    });&#10;                    node.setOnMouseExited(e -&gt; {&#10;                        node.setStyle(&quot;-fx-opacity: 1.0;&quot;);&#10;                    });&#10;                }&#10;            }&#10;&#10;        } catch (Exception e) {&#10;            System.err.println(&quot;Error loading top products chart: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    private void loadTableData() {&#10;        ArrayList&lt;ThongKeDoanhThu&gt; dsThongKe = thongKeDAO.getDoanhThuTheoThoiGian(tuNgay, denNgay, selectedNhanVien);&#10;        ObservableList&lt;ThongKeDoanhThu&gt; data = FXCollections.observableArrayList(dsThongKe);&#10;        tableChiTiet.setItems(data);&#10;    }&#10;&#10;    &#10;//    Xuất báo cáo thống kê doanh thu ra file CSV&#10;    private void xuatBaoCao() {&#10;        try {&#10;            // Tạo FileChooser để chọn nơi lưu file&#10;            FileChooser fileChooser = new FileChooser();&#10;            fileChooser.setTitle(&quot;Xuất báo cáo thống kê doanh thu&quot;);&#10;            fileChooser.setInitialFileName(&quot;BaoCaoDoanhThu_&quot; + LocalDate.now().format(DateTimeFormatter.ofPattern(&quot;ddMMyyyy&quot;)) + &quot;.csv&quot;);&#10;&#10;            // Thiết lập filter cho file CSV&#10;            FileChooser.ExtensionFilter extFilter = new FileChooser.ExtensionFilter(&quot;CSV files (*.csv)&quot;, &quot;*.csv&quot;);&#10;            fileChooser.getExtensionFilters().add(extFilter);&#10;&#10;            // Hiển thị dialog để chọn nơi lưu&#10;            File file = fileChooser.showSaveDialog(btnXuatBaoCao.getScene().getWindow());&#10;&#10;            if (file != null) {&#10;                // Xuất dữ liệu ra file CSV&#10;                exportToCSV(file);&#10;&#10;                // Hiển thị thông báo thành công&#10;                Alert alert = new Alert(Alert.AlertType.INFORMATION);&#10;                alert.setTitle(&quot;Xuất báo cáo thành công&quot;);&#10;                alert.setHeaderText(null);&#10;                alert.setContentText(&quot;Báo cáo đã được xuất thành công!\nĐường dẫn: &quot; + file.getAbsolutePath());&#10;                alert.showAndWait();&#10;            }&#10;        } catch (Exception e) {&#10;            // Hiển thị thông báo lỗi&#10;            Alert alert = new Alert(Alert.AlertType.ERROR);&#10;            alert.setTitle(&quot;Lỗi xuất báo cáo&quot;);&#10;            alert.setHeaderText(null);&#10;            alert.setContentText(&quot;Có lỗi xảy ra khi xuất báo cáo: &quot; + e.getMessage());&#10;            alert.showAndWait();&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;//    Xuất dữ liệu thống kê doanh thu ra file CSV&#10;    private void exportToCSV(File file) throws IOException {&#10;        // Kiểm tra xem có phải hiển thị theo tháng không&#10;        String thoiGian = cmbThoiGian.getValue();&#10;        boolean hienThiTheoThang = &quot;Năm nay&quot;.equals(thoiGian);&#10;&#10;        // Lấy dữ liệu&#10;        ArrayList&lt;ThongKeDoanhThu&gt; dsThongKe;&#10;        if (hienThiTheoThang) {&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThang(tuNgay, denNgay, selectedNhanVien);&#10;        } else {&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThoiGian(tuNgay, denNgay, selectedNhanVien);&#10;        }&#10;&#10;        // Tạo FileWriter với UTF-8 BOM để Excel hiển thị đúng tiếng Việt&#10;        try (FileWriter writer = new FileWriter(file)) {&#10;            // Thêm UTF-8 BOM&#10;            writer.write('\ufeff');&#10;&#10;            // Ghi header thông tin báo cáo&#10;            writer.append(&quot;BAO CAO THONG KE DOANH THU\n&quot;);&#10;            writer.append(&quot;Thoi gian: &quot;).append(thoiGian).append(&quot;\n&quot;);&#10;            writer.append(&quot;Tu ngay: &quot;).append(tuNgay.format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;))).append(&quot;\n&quot;);&#10;            writer.append(&quot;Den ngay: &quot;).append(denNgay.format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;))).append(&quot;\n&quot;);&#10;&#10;            String nhanVienText = selectedNhanVien != null ? selectedNhanVien : &quot;Tat ca&quot;;&#10;            writer.append(&quot;Nhan vien: &quot;).append(nhanVienText).append(&quot;\n&quot;);&#10;            writer.append(&quot;\n&quot;);&#10;&#10;            // Ghi thông tin tổng quan&#10;            writer.append(&quot;THONG TIN TONG QUAN\n&quot;);&#10;            double tongDoanhThu = thongKeDAO.getTongDoanhThu(tuNgay, denNgay, selectedNhanVien);&#10;            int tongDonHang = thongKeDAO.getTongDonHang(tuNgay, denNgay, selectedNhanVien);&#10;            int soKhachHang = thongKeDAO.getSoKhachHangMoi(tuNgay, denNgay, selectedNhanVien);&#10;            double donHangTB = tongDonHang &gt; 0 ? tongDoanhThu / tongDonHang : 0;&#10;&#10;            writer.append(&quot;Tong doanh thu,&quot;).append(String.format(&quot;%.2f&quot;, tongDoanhThu)).append(&quot; VND\n&quot;);&#10;            writer.append(&quot;Tong don hang,&quot;).append(String.valueOf(tongDonHang)).append(&quot;\n&quot;);&#10;            writer.append(&quot;Don hang trung binh,&quot;).append(String.format(&quot;%.2f&quot;, donHangTB)).append(&quot; VND\n&quot;);&#10;            writer.append(&quot;So khach hang,&quot;).append(String.valueOf(soKhachHang)).append(&quot;\n&quot;);&#10;            writer.append(&quot;\n&quot;);&#10;&#10;            // Ghi header cho bảng chi tiết&#10;            writer.append(&quot;CHI TIET DOANH THU\n&quot;);&#10;            if (hienThiTheoThang) {&#10;                writer.append(&quot;Thang,So don hang,Doanh thu (VND),Don hang TB (VND),Khach hang moi,Nhan vien ban\n&quot;);&#10;            } else {&#10;                writer.append(&quot;Ngay,So don hang,Doanh thu (VND),Don hang TB (VND),Khach hang moi,Nhan vien ban\n&quot;);&#10;            }&#10;&#10;            // Ghi dữ liệu chi tiết&#10;            DateTimeFormatter dateFormatter = hienThiTheoThang&#10;                ? DateTimeFormatter.ofPattern(&quot;MM/yyyy&quot;)&#10;                : DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);&#10;&#10;            for (ThongKeDoanhThu tk : dsThongKe) {&#10;                writer.append(tk.getNgay().format(dateFormatter)).append(&quot;,&quot;);&#10;                writer.append(String.valueOf(tk.getSoDonHang())).append(&quot;,&quot;);&#10;                writer.append(String.format(&quot;%.2f&quot;, tk.getDoanhThu())).append(&quot;,&quot;);&#10;                writer.append(String.format(&quot;%.2f&quot;, tk.getDonHangTB())).append(&quot;,&quot;);&#10;                writer.append(String.valueOf(tk.getKhachHangMoi())).append(&quot;,&quot;);&#10;                writer.append(tk.getNhanVienBan() != null ? tk.getNhanVienBan() : &quot;&quot;).append(&quot;\n&quot;);&#10;            }&#10;&#10;            writer.append(&quot;\n&quot;);&#10;&#10;            // Ghi top sản phẩm bán chạy&#10;            writer.append(&quot;TOP SAN PHAM BAN CHAY\n&quot;);&#10;            writer.append(&quot;Ten thuoc,So luong ban\n&quot;);&#10;&#10;            Map&lt;String, Integer&gt; topSanPham = thongKeDAO.getTopSanPhamBanChay(tuNgay, denNgay, 5);&#10;            for (Map.Entry&lt;String, Integer&gt; entry : topSanPham.entrySet()) {&#10;                writer.append(entry.getKey()).append(&quot;,&quot;);&#10;                writer.append(String.valueOf(entry.getValue())).append(&quot;\n&quot;);&#10;            }&#10;&#10;            writer.flush();&#10;        }&#10;    }&#10;&#10;//    Định dạng số tiền với đơn vị K, M, B&#10;    private String formatCurrency(double amount) {&#10;        if (amount &gt;= 1_000_000_000) {&#10;            return percentFormatter.format(amount / 1_000_000_000) + &quot;B&quot;;&#10;        } else if (amount &gt;= 1_000_000) {&#10;            return percentFormatter.format(amount / 1_000_000) + &quot;M&quot;;&#10;        } else if (amount &gt;= 1_000) {&#10;            return percentFormatter.format(amount / 1_000) + &quot;K&quot;;&#10;        }&#10;        return formatter.format(amount);&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.antam.app.controller.hoadon;&#10;&#10;import com.antam.app.dao.ThongKeDoanhThu_DAO;&#10;import com.antam.app.dao.ThongKeTrangChinh_DAO;&#10;import com.antam.app.entity.NhanVien;&#10;import com.antam.app.entity.ThongKeDoanhThu;&#10;import javafx.collections.FXCollections;&#10;import javafx.collections.ObservableList;&#10;import javafx.event.ActionEvent;&#10;import javafx.fxml.Initializable;&#10;import javafx.scene.Node;&#10;import javafx.scene.chart.BarChart;&#10;import javafx.scene.chart.LineChart;&#10;import javafx.scene.chart.XYChart;&#10;import javafx.scene.control.*;&#10;import javafx.scene.control.cell.PropertyValueFactory;&#10;import javafx.scene.text.Text;&#10;import javafx.stage.FileChooser;&#10;&#10;import java.io.File;&#10;import java.io.FileWriter;&#10;import java.io.IOException;&#10;import java.net.URL;&#10;import java.text.DecimalFormat;&#10;import java.time.LocalDate;&#10;import java.time.format.DateTimeFormatter;&#10;import java.util.ArrayList;&#10;import java.util.Map;&#10;import java.util.ResourceBundle;&#10;&#10;import de.jensd.fx.glyphs.fontawesome.FontAwesomeIcon;&#10;import javafx.geometry.Pos;&#10;import javafx.scene.chart.*;&#10;import javafx.scene.control.Button;&#10;import javafx.scene.control.Label;&#10;import javafx.scene.effect.DropShadow;&#10;import javafx.scene.layout.*;&#10;import javafx.scene.text.Font;&#10;import javafx.geometry.Insets;&#10;import javafx.scene.paint.Color;&#10;&#10;&#10;public class ThongKeDoanhThuController extends ScrollPane {&#10;&#10;     private Button btnXuatBaoCao;&#10;     private ComboBox&lt;String&gt; cmbThoiGian;&#10;     private ComboBox&lt;String&gt; cmbNhanVien;&#10;&#10;     private Text txtDoanhThuKy;&#10;     private Text txtSoDonHang;&#10;     private Text txtDonHangTB;&#10;     private Text txtSoKhachHang;&#10;&#10;     private Button btnDoanhThuChange;&#10;     private Button btnDonHangChange;&#10;     private Button btnDonHangTBChange;&#10;     private Button btnKhachHangChange;&#10;&#10;     private LineChart&lt;String, Number&gt; chartDoanhThu;&#10;     private BarChart&lt;String, Number&gt; chartTopSanPham;&#10;&#10;     private TableView&lt;ThongKeDoanhThu&gt; tableChiTiet;&#10;     private TableColumn&lt;ThongKeDoanhThu, LocalDate&gt; colNgay;&#10;     private TableColumn&lt;ThongKeDoanhThu, Integer&gt; colSoDonHang;&#10;     private TableColumn&lt;ThongKeDoanhThu, Double&gt; colDoanhThu;&#10;     private TableColumn&lt;ThongKeDoanhThu, Double&gt; colDonHangTB;&#10;     private TableColumn&lt;ThongKeDoanhThu, Integer&gt; colKhachHangMoi;&#10;     private TableColumn&lt;ThongKeDoanhThu, String&gt; colNhanVienBan;&#10;&#10;     private Button btnRefresh;&#10;&#10;    private ThongKeDoanhThu_DAO thongKeDAO;&#10;    private ThongKeTrangChinh_DAO thongKeTrangChinhDAO;&#10;    private LocalDate tuNgay;&#10;    private LocalDate denNgay;&#10;    private String selectedNhanVien = null;&#10;    private DecimalFormat formatter = new DecimalFormat(&quot;#,###&quot;);&#10;    private DecimalFormat percentFormatter = new DecimalFormat(&quot;#0.0&quot;);&#10;&#10;    public ThongKeDoanhThuController(){&#10;        this.setFitToHeight(true);&#10;        this.setFitToWidth(true);&#10;        this.setPrefSize(900, 730);&#10;        AnchorPane.setTopAnchor(this, 0.0);&#10;        AnchorPane.setBottomAnchor(this, 0.0);&#10;        AnchorPane.setLeftAnchor(this, 0.0);&#10;        AnchorPane.setRightAnchor(this, 0.0);&#10;&#10;        VBox root = new VBox(30);&#10;        root.setStyle(&quot;-fx-background-color: #f8fafc;&quot;);&#10;        setContent(root);&#10;&#10;        // ---------------------- HEADER ----------------------&#10;        HBox header = new HBox();&#10;        header.setAlignment(Pos.CENTER_LEFT);&#10;&#10;        Text title = new Text(&quot;Thống kê doanh thu&quot;);&#10;        title.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;        title.setFont(Font.font(&quot;System Bold&quot;, 30));&#10;&#10;        Region space = new Region();&#10;        HBox.setHgrow(space, Priority.ALWAYS);&#10;&#10;        btnXuatBaoCao = new Button(&quot;Xuất báo cáo&quot;);&#10;        btnXuatBaoCao.setPrefSize(120, 50);&#10;        btnXuatBaoCao.getStyleClass().add(&quot;btn-gray&quot;);&#10;        btnXuatBaoCao.setTextFill(Color.WHITE);&#10;&#10;        FontAwesomeIcon iconDownload = new FontAwesomeIcon();&#10;        iconDownload.setGlyphName(&quot;CLOUD_DOWNLOAD&quot;);&#10;        iconDownload.setFill(Color.WHITE);&#10;        btnXuatBaoCao.setGraphic(iconDownload);&#10;&#10;        header.getChildren().addAll(title, space, btnXuatBaoCao);&#10;&#10;        // ---------------------- FILTER PANE ----------------------&#10;        FlowPane filterPane = new FlowPane(5, 5);&#10;        filterPane.setPadding(new Insets(10));&#10;        filterPane.getStyleClass().add(&quot;box-pane&quot;);&#10;        filterPane.setEffect(new DropShadow(20, Color.rgb(211, 211, 211)));&#10;&#10;        // TIME COMBOBOX&#10;        VBox vbTime = new VBox(5);&#10;        Text txtTime = new Text(&quot;Thời gian:&quot;);&#10;        txtTime.setFill(Color.web(&quot;#374151&quot;));&#10;        cmbThoiGian = new ComboBox&lt;&gt;();&#10;        cmbThoiGian.setPrefSize(200, 40);&#10;        cmbThoiGian.getStyleClass().add(&quot;combo-box&quot;);&#10;&#10;        vbTime.getChildren().addAll(txtTime, cmbThoiGian);&#10;&#10;        // EMPLOYEE COMBOBOX&#10;        VBox vbNV = new VBox(5);&#10;        Text txtNV = new Text(&quot;Nhân viên:&quot;);&#10;        txtNV.setFill(Color.web(&quot;#374151&quot;));&#10;        cmbNhanVien = new ComboBox&lt;&gt;();&#10;        cmbNhanVien.setPrefSize(200, 40);&#10;        cmbNhanVien.getStyleClass().add(&quot;combo-box&quot;);&#10;&#10;        vbNV.getChildren().addAll(txtNV, cmbNhanVien);&#10;&#10;        filterPane.getChildren().addAll(vbTime, vbNV);&#10;&#10;        // ---------------------- STAT CARDS ----------------------&#10;        FlowPane cards = new FlowPane(30, 20);&#10;        cards.setAlignment(Pos.CENTER);&#10;&#10;        // Card 1 – DOANH THU KY&#10;        StackPane card1 = createCard(&#10;                &quot;#059669&quot;,&#10;                &quot;MONEY&quot;,&#10;                txtDoanhThuKy = new Text(&quot;0&quot;),&#10;                new Text(&quot;Doanh thu kỳ&quot;),&#10;                btnDoanhThuChange = new Button(&quot;0%&quot;)&#10;        );&#10;        // Card 2 – DON HANG&#10;        StackPane card2 = createCard(&#10;                &quot;#2563eb&quot;,&#10;                &quot;FILE&quot;,&#10;                txtSoDonHang = new Text(&quot;0&quot;),&#10;                new Text(&quot;Đơn hàng&quot;),&#10;                btnDonHangChange = new Button(&quot;0%&quot;)&#10;        );&#10;        // Card 3 – DON HANG TB&#10;        StackPane card3 = createCard(&#10;                &quot;#8b5cf6&quot;,&#10;                &quot;CALCULATOR&quot;,&#10;                txtDonHangTB = new Text(&quot;0&quot;),&#10;                new Text(&quot;Đơn hàng TB&quot;),&#10;                btnDonHangTBChange = new Button(&quot;0%&quot;)&#10;        );&#10;        // Card 4 – KHÁCH HÀNG&#10;        StackPane card4 = createCard(&#10;                &quot;#f59e0b&quot;,&#10;                &quot;USERS&quot;,&#10;                txtSoKhachHang = new Text(&quot;0&quot;),&#10;                new Text(&quot;Khách hàng&quot;),&#10;                btnKhachHangChange = new Button(&quot;0%&quot;)&#10;        );&#10;&#10;        cards.getChildren().addAll(card1, card2, card3, card4);&#10;&#10;        // ---------------------- CHARTS ----------------------&#10;        FlowPane charts = new FlowPane(20, 20);&#10;        charts.setAlignment(Pos.TOP_CENTER);&#10;&#10;        // LINE CHART&#10;        CategoryAxis x1 = new CategoryAxis();&#10;        NumberAxis y1 = new NumberAxis();&#10;        chartDoanhThu = new LineChart&lt;&gt;(x1, y1);&#10;&#10;        VBox vbChart1 = wrapChart(&quot;Doanh thu theo thời gian&quot;, chartDoanhThu);&#10;&#10;        // BAR CHART&#10;        CategoryAxis x2 = new CategoryAxis();&#10;        NumberAxis y2 = new NumberAxis();&#10;        chartTopSanPham = new BarChart&lt;&gt;(x2, y2);&#10;&#10;        VBox vbChart2 = wrapChart(&quot;Top sản phẩm bán chạy&quot;, chartTopSanPham);&#10;        charts.getChildren().addAll(vbChart1, vbChart2);&#10;&#10;        // ---------------------- TABLE ----------------------&#10;        AnchorPane tablePane = new AnchorPane();&#10;        tablePane.getStyleClass().add(&quot;box-pane&quot;);&#10;&#10;        VBox vbTable = new VBox(5);&#10;        vbTable.setPadding(new Insets(5));&#10;&#10;        HBox tbHeader = new HBox();&#10;        Text tbTitle = new Text(&quot;Chi tiết doanh thu&quot;);&#10;        tbTitle.setFont(Font.font(&quot;System Bold&quot;, 20));&#10;        tbTitle.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;&#10;        Region tbSpace = new Region();&#10;        HBox.setHgrow(tbSpace, Priority.ALWAYS);&#10;&#10;        btnRefresh = new Button();&#10;        btnRefresh.setPrefSize(50, 40);&#10;        btnRefresh.setStyle(&quot;-fx-background-color: #6b7280; -fx-border-radius: 8px;&quot;);&#10;&#10;        FontAwesomeIcon refreshIcon = new FontAwesomeIcon();&#10;        refreshIcon.setGlyphName(&quot;REFRESH&quot;);&#10;        refreshIcon.setFill(Color.WHITE);&#10;        btnRefresh.setGraphic(refreshIcon);&#10;&#10;        tbHeader.getChildren().addAll(tbTitle, tbSpace, btnRefresh);&#10;&#10;        // TableView&#10;        tableChiTiet = new TableView&lt;&gt;();&#10;        tableChiTiet.setPrefHeight(500);&#10;&#10;        colNgay = new TableColumn&lt;&gt;(&quot;Ngày&quot;);&#10;        colSoDonHang = new TableColumn&lt;&gt;(&quot;Số đơn hàng&quot;);&#10;        colDoanhThu = new TableColumn&lt;&gt;(&quot;Doanh thu&quot;);&#10;        colDonHangTB = new TableColumn&lt;&gt;(&quot;Đơn hàng TB&quot;);&#10;        colKhachHangMoi = new TableColumn&lt;&gt;(&quot;Khách hàng mới&quot;);&#10;        colNhanVienBan = new TableColumn&lt;&gt;(&quot;Nhân viên bán&quot;);&#10;&#10;        tableChiTiet.getColumns().addAll(&#10;                colNgay, colSoDonHang, colDoanhThu,&#10;                colDonHangTB, colKhachHangMoi, colNhanVienBan&#10;        );&#10;&#10;        vbTable.getChildren().addAll(tbHeader, tableChiTiet);&#10;&#10;        AnchorPane.setLeftAnchor(vbTable, 0.0);&#10;        AnchorPane.setRightAnchor(vbTable, 0.0);&#10;        tablePane.getChildren().add(vbTable);&#10;&#10;        // ---------------- ADD ALL ----------------&#10;        root.setPadding(new Insets(20));&#10;        root.getChildren().addAll(header, filterPane, cards, charts, tablePane);&#10;        this.getStylesheets().add(getClass().getResource(&quot;/com/antam/app/styles/dashboard_style.css&quot;).toExternalForm());&#10;        this.getChildren().add(root);&#10;&#10;        /** Sự kiện **/&#10;        thongKeDAO = new ThongKeDoanhThu_DAO();&#10;        thongKeTrangChinhDAO = new ThongKeTrangChinh_DAO();&#10;&#10;        // Khởi tạo ComboBox thời gian&#10;        cmbThoiGian.setItems(FXCollections.observableArrayList(&#10;                &quot;Hôm nay&quot;, &quot;7 ngày qua&quot;, &quot;30 ngày qua&quot;, &quot;Tháng này&quot;, &quot;Tháng trước&quot;, &quot;Năm nay&quot;&#10;        ));&#10;        cmbThoiGian.setValue(&quot;7 ngày qua&quot;);&#10;&#10;        // Load danh sách nhân viên&#10;        loadDanhSachNhanVien();&#10;&#10;        // Khởi tạo bảng&#10;        setupTableView();&#10;&#10;        // Tính thời gian mặc định&#10;        calculateDefaultTimeRange();&#10;&#10;        // Load dữ liệu&#10;        loadData();&#10;        &#10;        // Thêm event handlers&#10;        cmbThoiGian.setOnAction(e -&gt; locTheoThoiGian(e));&#10;        cmbNhanVien.setOnAction(e -&gt; locTheoNhanVien(e));&#10;        btnRefresh.setOnAction(e-&gt;refreshData());&#10;        btnXuatBaoCao.setOnAction(e-&gt;xuatBaoCao());&#10;&#10;    }&#10;&#10;    private StackPane createCard(String color, String icon, Text bigText, Text label, Button changeBtn) {&#10;&#10;        StackPane card = new StackPane();&#10;        card.setPrefSize(250, 121);&#10;        card.setStyle(&quot;-fx-background-color: white; -fx-background-radius: 20px;&quot;);&#10;        card.setEffect(new DropShadow(10, Color.rgb(212, 212, 212)));&#10;&#10;        HBox box = new HBox(10);&#10;        box.setAlignment(Pos.CENTER_LEFT);&#10;        box.setPadding(new Insets(0, 20, 0, 20));&#10;&#10;        Button iconBtn = new Button();&#10;        iconBtn.setPrefSize(60, 60);&#10;        iconBtn.setStyle(&quot;-fx-background-color: &quot; + color + &quot;; -fx-background-radius: 15px;&quot;);&#10;&#10;        FontAwesomeIcon iconNode = new FontAwesomeIcon();&#10;        iconNode.setGlyphName(icon);&#10;        iconNode.setFill(Color.WHITE);&#10;        iconNode.setSize(&quot;2em&quot;);&#10;        iconBtn.setGraphic(iconNode);&#10;&#10;        VBox texts = new VBox();&#10;        texts.setPrefHeight(60);&#10;        texts.setAlignment(Pos.CENTER_LEFT);&#10;        bigText.setFont(Font.font(&quot;System Bold&quot;, 32));&#10;        bigText.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;&#10;        label.setFill(Color.web(&quot;#64748b&quot;));&#10;        changeBtn.setStyle(&quot;-fx-background-radius: 50px;&quot;);&#10;&#10;        texts.getChildren().addAll(bigText, label, changeBtn);&#10;&#10;        box.getChildren().addAll(iconBtn, texts);&#10;        card.getChildren().add(box);&#10;&#10;        return card;&#10;    }&#10;&#10;    // ---------------------------------------------------------&#10;    //  HELPER: tạo chart wrapper box-pane&#10;    // ---------------------------------------------------------&#10;    private VBox wrapChart(String titleStr, Node chart) {&#10;        VBox box = new VBox(10);&#10;        box.setPrefWidth(500);&#10;        box.setPadding(new Insets(10));&#10;        box.getStyleClass().add(&quot;box-pane&quot;);&#10;        box.setEffect(new DropShadow(12, Color.rgb(218, 218, 218)));&#10;&#10;        Text title = new Text(titleStr);&#10;        title.setFont(Font.font(&quot;System Bold&quot;, 20));&#10;        title.setFill(Color.web(&quot;#1e3a8a&quot;));&#10;&#10;        box.getChildren().addAll(title, chart);&#10;        return box;&#10;    }&#10;&#10;    private void setupTableView() {&#10;        // Thêm placeholder cho bảng khi không có dữ liệu&#10;        Label placeholderLabel = new Label(&quot;Không có dữ liệu&quot;);&#10;        placeholderLabel.setStyle(&quot;-fx-font-size: 14px; -fx-text-fill: #64748b;&quot;);&#10;        tableChiTiet.setPlaceholder(placeholderLabel);&#10;&#10;        colNgay.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;ngay&quot;));&#10;        colNgay.setCellFactory(column -&gt; new TableCell&lt;ThongKeDoanhThu, LocalDate&gt;() {&#10;            @Override&#10;            protected void updateItem(LocalDate item, boolean empty) {&#10;                super.updateItem(item, empty);&#10;                if (empty || item == null) {&#10;                    setText(null);&#10;                } else {&#10;                    setText(item.format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;)));&#10;                }&#10;            }&#10;        });&#10;&#10;        colSoDonHang.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;soDonHang&quot;));&#10;&#10;        colDoanhThu.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;doanhThu&quot;));&#10;        colDoanhThu.setCellFactory(column -&gt; new TableCell&lt;ThongKeDoanhThu, Double&gt;() {&#10;            @Override&#10;            protected void updateItem(Double item, boolean empty) {&#10;                super.updateItem(item, empty);&#10;                if (empty || item == null) {&#10;                    setText(null);&#10;                } else {&#10;                    setText(formatter.format(item) + &quot; đ&quot;);&#10;                }&#10;            }&#10;        });&#10;&#10;        colDonHangTB.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;donHangTB&quot;));&#10;        colDonHangTB.setCellFactory(column -&gt; new TableCell&lt;ThongKeDoanhThu, Double&gt;() {&#10;            @Override&#10;            protected void updateItem(Double item, boolean empty) {&#10;                super.updateItem(item, empty);&#10;                if (empty || item == null) {&#10;                    setText(null);&#10;                } else {&#10;                    setText(formatter.format(item) + &quot; đ&quot;);&#10;                }&#10;            }&#10;        });&#10;&#10;        colKhachHangMoi.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;khachHangMoi&quot;));&#10;        colNhanVienBan.setCellValueFactory(new PropertyValueFactory&lt;&gt;(&quot;nhanVienBan&quot;));&#10;    }&#10;&#10;    private void loadDanhSachNhanVien() {&#10;        ArrayList&lt;NhanVien&gt; dsNhanVien = thongKeDAO.getDanhSachNhanVien();&#10;        ObservableList&lt;String&gt; items = FXCollections.observableArrayList(&quot;Tất cả&quot;);&#10;        for (NhanVien nv : dsNhanVien) {&#10;            items.add(nv.getMaNV() + &quot; - &quot; + nv.getHoTen());&#10;        }&#10;        cmbNhanVien.setItems(items);&#10;        cmbNhanVien.setValue(&quot;Tất cả&quot;);&#10;    }&#10;&#10;    private void calculateDefaultTimeRange() {&#10;        String thoiGian = cmbThoiGian.getValue();&#10;        denNgay = LocalDate.now();&#10;&#10;        switch (thoiGian) {&#10;            case &quot;Hôm nay&quot;:&#10;                tuNgay = LocalDate.now();&#10;                break;&#10;            case &quot;7 ngày qua&quot;:&#10;                tuNgay = LocalDate.now().minusDays(6);&#10;                break;&#10;            case &quot;30 ngày qua&quot;:&#10;                tuNgay = LocalDate.now().minusDays(29);&#10;                break;&#10;            case &quot;Tháng này&quot;:&#10;                tuNgay = LocalDate.now().withDayOfMonth(1);&#10;                break;&#10;            case &quot;Tháng trước&quot;:&#10;                tuNgay = LocalDate.now().minusMonths(1).withDayOfMonth(1);&#10;                denNgay = LocalDate.now().withDayOfMonth(1).minusDays(1);&#10;                break;&#10;            case &quot;Năm nay&quot;:&#10;                tuNgay = LocalDate.now().withDayOfYear(1);&#10;                break;&#10;            default:&#10;                tuNgay = LocalDate.now().minusDays(6);&#10;        }&#10;    }&#10;&#10;    &#10;    private void locTheoThoiGian(ActionEvent event) {&#10;        calculateDefaultTimeRange();&#10;        loadData();&#10;    }&#10;&#10;    &#10;    private void locTheoNhanVien(ActionEvent event) {&#10;        String selected = cmbNhanVien.getValue();&#10;        if (selected != null &amp;&amp; !selected.equals(&quot;Tất cả&quot;)) {&#10;            selectedNhanVien = selected.split(&quot; - &quot;)[0];&#10;        } else {&#10;            selectedNhanVien = null;&#10;        }&#10;        loadData();&#10;    }&#10;&#10;    &#10;    private void refreshData() {&#10;        loadData();&#10;    }&#10;&#10;    private void loadData() {&#10;        // Load dữ liệu tổng quan&#10;        loadTongQuan();&#10;&#10;        // Load biểu đồ&#10;        loadChartDoanhThu();&#10;        loadTopProductsChart();&#10;&#10;        // Load bảng chi tiết&#10;        loadTableData();&#10;    }&#10;&#10;    private void loadTongQuan() {&#10;        double tongDoanhThu = thongKeDAO.getTongDoanhThu(tuNgay, denNgay, selectedNhanVien);&#10;        int tongDonHang = thongKeDAO.getTongDonHang(tuNgay, denNgay, selectedNhanVien);&#10;        int soKhachHang = thongKeDAO.getSoKhachHangMoi(tuNgay, denNgay, selectedNhanVien);&#10;        double donHangTB = tongDonHang &gt; 0 ? tongDoanhThu / tongDonHang : 0;&#10;&#10;        // Cập nhật text&#10;        txtDoanhThuKy.setText(formatCurrency(tongDoanhThu));&#10;        txtSoDonHang.setText(String.valueOf(tongDonHang));&#10;        txtDonHangTB.setText(formatCurrency(donHangTB));&#10;        txtSoKhachHang.setText(String.valueOf(soKhachHang));&#10;&#10;        // Tính % thay đổi so với kỳ trước (đơn giản hóa - có thể cải thiện)&#10;        calculateChange();&#10;    }&#10;&#10;    /*&#10;    * Tính phần trăm thay đổi so với kỳ trước và cập nhật nút tương ứng&#10;    * */&#10;    private void calculateChange() {&#10;        // Tính kỳ trước&#10;        long days = java.time.temporal.ChronoUnit.DAYS.between(tuNgay, denNgay) + 1;&#10;        LocalDate tuNgayTruoc = tuNgay.minusDays(days);&#10;        LocalDate denNgayTruoc = denNgay.minusDays(days);&#10;&#10;        double doanhThuHienTai = thongKeDAO.getTongDoanhThu(tuNgay, denNgay, selectedNhanVien);&#10;        double doanhThuTruoc = thongKeDAO.getTongDoanhThu(tuNgayTruoc, denNgayTruoc, selectedNhanVien);&#10;&#10;        int donHangHienTai = thongKeDAO.getTongDonHang(tuNgay, denNgay, selectedNhanVien);&#10;        int donHangTruoc = thongKeDAO.getTongDonHang(tuNgayTruoc, denNgayTruoc, selectedNhanVien);&#10;&#10;        int khachHangHienTai = thongKeDAO.getSoKhachHangMoi(tuNgay, denNgay, selectedNhanVien);&#10;        int khachHangTruoc = thongKeDAO.getSoKhachHangMoi(tuNgayTruoc, denNgayTruoc, selectedNhanVien);&#10;&#10;        updateChangeButton(btnDoanhThuChange, doanhThuHienTai, doanhThuTruoc);&#10;        updateChangeButton(btnDonHangChange, donHangHienTai, donHangTruoc);&#10;        updateChangeButton(btnDonHangTBChange,&#10;            donHangHienTai &gt; 0 ? doanhThuHienTai / donHangHienTai : 0,&#10;            donHangTruoc &gt; 0 ? doanhThuTruoc / donHangTruoc : 0);&#10;        updateChangeButton(btnKhachHangChange, khachHangHienTai, khachHangTruoc);&#10;    }&#10;&#10;    /*&#10;    *  Cập nhật nút thay đổi với phần trăm và màu sắc tương ứng&#10;    * */&#10;    private void updateChangeButton(Button btn, double current, double previous) {&#10;        if (previous == 0) {&#10;            btn.setText(&quot;N/A&quot;);&#10;            return;&#10;        }&#10;&#10;        double change = ((current - previous) / previous) * 100;&#10;        String text = (change &gt;= 0 ? &quot;+&quot; : &quot;&quot;) + percentFormatter.format(change) + &quot;%&quot;;&#10;        btn.setText(text);&#10;&#10;        if (change &gt;= 0) {&#10;            btn.setStyle(&quot;-fx-background-color: #d1fae5; -fx-text-fill: #059669; -fx-background-radius: 50px;&quot;);&#10;        } else {&#10;            btn.setStyle(&quot;-fx-background-color: #fee2e2; -fx-text-fill: #dc2626; -fx-background-radius: 50px;&quot;);&#10;        }&#10;    }&#10;&#10;    private void loadChartDoanhThu() {&#10;        chartDoanhThu.getData().clear();&#10;&#10;        // Kiểm tra xem có phải hiển thị theo tháng không (cho khoảng thời gian dài như năm)&#10;        String thoiGian = cmbThoiGian.getValue();&#10;        boolean hienThiTheoThang = &quot;Năm nay&quot;.equals(thoiGian);&#10;&#10;        ArrayList&lt;ThongKeDoanhThu&gt; dsThongKe;&#10;        if (hienThiTheoThang) {&#10;            // Lấy dữ liệu theo tháng&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThang(tuNgay, denNgay, selectedNhanVien);&#10;        } else {&#10;            // Lấy dữ liệu theo ngày&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThoiGian(tuNgay, denNgay, selectedNhanVien);&#10;        }&#10;&#10;        XYChart.Series&lt;String, Number&gt; series = new XYChart.Series&lt;&gt;();&#10;        series.setName(&quot;Doanh thu&quot;);&#10;&#10;        DateTimeFormatter dateFormatter = hienThiTheoThang&#10;            ? DateTimeFormatter.ofPattern(&quot;MM/yyyy&quot;)&#10;            : DateTimeFormatter.ofPattern(&quot;dd/MM&quot;);&#10;        DateTimeFormatter fullDateFormatter = hienThiTheoThang&#10;            ? DateTimeFormatter.ofPattern(&quot;'Tháng' MM/yyyy&quot;)&#10;            : DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);&#10;&#10;        if (hienThiTheoThang) {&#10;            // Hiển thị theo tháng - tạo đầy đủ các tháng trong khoảng thời gian&#10;            Map&lt;String, ThongKeDoanhThu&gt; dataMap = new java.util.HashMap&lt;&gt;();&#10;            for (ThongKeDoanhThu tk : dsThongKe) {&#10;                String monthKey = tk.getNgay().format(dateFormatter);&#10;                dataMap.put(monthKey, tk);&#10;            }&#10;&#10;            Map&lt;String, ThongKeDoanhThu&gt; displayMap = new java.util.LinkedHashMap&lt;&gt;();&#10;&#10;            // Tạo đầy đủ các tháng từ tuNgay đến denNgay&#10;            LocalDate currentMonth = tuNgay.withDayOfMonth(1);&#10;            LocalDate endMonth = denNgay.withDayOfMonth(1);&#10;            &#10;            while (!currentMonth.isAfter(endMonth)) {&#10;                String monthKey = currentMonth.format(dateFormatter);&#10;                ThongKeDoanhThu tk = dataMap.get(monthKey);&#10;                &#10;                if (tk == null) {&#10;                    // Tạo dữ liệu rỗng cho tháng không có data&#10;                    tk = new ThongKeDoanhThu(currentMonth, 0, 0.0, 0.0, 0, &quot;&quot;);&#10;                }&#10;                &#10;                displayMap.put(monthKey, tk);&#10;                series.getData().add(new XYChart.Data&lt;&gt;(monthKey, tk.getDoanhThu()));&#10;                &#10;                currentMonth = currentMonth.plusMonths(1);&#10;            }&#10;&#10;            chartDoanhThu.getData().add(series);&#10;&#10;            // Thêm tooltip cho từng điểm dữ liệu&#10;            for (XYChart.Data&lt;String, Number&gt; data : series.getData()) {&#10;                ThongKeDoanhThu tk = displayMap.get(data.getXValue());&#10;                if (tk != null) {&#10;                    Tooltip tooltip = new Tooltip(&#10;                        tk.getNgay().format(fullDateFormatter) + &quot;\n&quot; +&#10;                        &quot;Doanh thu: &quot; + formatter.format(data.getYValue().doubleValue()) + &quot; đ\n&quot; +&#10;                        &quot;Số đơn hàng: &quot; + tk.getSoDonHang() + &quot;\n&quot; +&#10;                        &quot;Đơn hàng TB: &quot; + formatter.format(tk.getDonHangTB()) + &quot; đ\n&quot; +&#10;                        &quot;Khách hàng: &quot; + tk.getKhachHangMoi()&#10;                    );&#10;&#10;                    tooltip.setShowDelay(javafx.util.Duration.millis(100));&#10;                    tooltip.setStyle(&#10;                        &quot;-fx-font-size: 12px; &quot; +&#10;                        &quot;-fx-background-color: rgba(30, 58, 138, 0.95); &quot; +&#10;                        &quot;-fx-text-fill: white; &quot; +&#10;                        &quot;-fx-padding: 8px; &quot; +&#10;                        &quot;-fx-background-radius: 6px;&quot;&#10;                    );&#10;&#10;                    javafx.scene.Node node = data.getNode();&#10;                    if (node != null) {&#10;                        Tooltip.install(node, tooltip);&#10;&#10;                        node.setOnMouseEntered(e -&gt; {&#10;                            node.setStyle(&#10;                                &quot;-fx-cursor: hand; &quot; +&#10;                                &quot;-fx-background-color: #059669; &quot; +&#10;                                &quot;-fx-background-radius: 8px;&quot;&#10;                            );&#10;                            node.setScaleX(1.5);&#10;                            node.setScaleY(1.5);&#10;                        });&#10;                        node.setOnMouseExited(e -&gt; {&#10;                            node.setStyle(&quot;&quot;);&#10;                            node.setScaleX(1.0);&#10;                            node.setScaleY(1.0);&#10;                        });&#10;                    }&#10;                }&#10;            }&#10;        } else {&#10;            // Hiển thị theo ngày - tạo đầy đủ các ngày&#10;            Map&lt;LocalDate, ThongKeDoanhThu&gt; dataMap = new java.util.HashMap&lt;&gt;();&#10;            for (ThongKeDoanhThu tk : dsThongKe) {&#10;                dataMap.put(tk.getNgay(), tk);&#10;            }&#10;&#10;            Map&lt;String, ThongKeDoanhThu&gt; displayMap = new java.util.LinkedHashMap&lt;&gt;();&#10;&#10;            LocalDate currentDate = tuNgay;&#10;            while (!currentDate.isAfter(denNgay)) {&#10;                ThongKeDoanhThu tk = dataMap.get(currentDate);&#10;&#10;                if (tk == null) {&#10;                    tk = new ThongKeDoanhThu(currentDate, 0, 0.0, 0.0, 0, &quot;&quot;);&#10;                }&#10;&#10;                String shortDate = currentDate.format(dateFormatter);&#10;                displayMap.put(shortDate, tk);&#10;                series.getData().add(new XYChart.Data&lt;&gt;(shortDate, tk.getDoanhThu()));&#10;&#10;                currentDate = currentDate.plusDays(1);&#10;            }&#10;&#10;            chartDoanhThu.getData().add(series);&#10;&#10;            // Thêm tooltip cho từng điểm dữ liệu&#10;            for (XYChart.Data&lt;String, Number&gt; data : series.getData()) {&#10;                ThongKeDoanhThu tk = displayMap.get(data.getXValue());&#10;                if (tk != null) {&#10;                    Tooltip tooltip = new Tooltip(&#10;                        &quot;Ngày: &quot; + tk.getNgay().format(fullDateFormatter) + &quot;\n&quot; +&#10;                        &quot;Doanh thu: &quot; + formatter.format(data.getYValue().doubleValue()) + &quot; đ\n&quot; +&#10;                        &quot;Số đơn hàng: &quot; + tk.getSoDonHang() + &quot;\n&quot; +&#10;                        &quot;Đơn hàng TB: &quot; + formatter.format(tk.getDonHangTB()) + &quot; đ\n&quot; +&#10;                        &quot;Khách hàng: &quot; + tk.getKhachHangMoi()&#10;                    );&#10;&#10;                    tooltip.setShowDelay(javafx.util.Duration.millis(100));&#10;                    tooltip.setStyle(&#10;                        &quot;-fx-font-size: 12px; &quot; +&#10;                        &quot;-fx-background-color: rgba(30, 58, 138, 0.95); &quot; +&#10;                        &quot;-fx-text-fill: white; &quot; +&#10;                        &quot;-fx-padding: 8px; &quot; +&#10;                        &quot;-fx-background-radius: 6px;&quot;&#10;                    );&#10;&#10;                    javafx.scene.Node node = data.getNode();&#10;                    if (node != null) {&#10;                        Tooltip.install(node, tooltip);&#10;&#10;                        node.setOnMouseEntered(e -&gt; {&#10;                            node.setStyle(&#10;                                &quot;-fx-cursor: hand; &quot; +&#10;                                &quot;-fx-background-color: #059669; &quot; +&#10;                                &quot;-fx-background-radius: 8px;&quot;&#10;                            );&#10;                            node.setScaleX(1.5);&#10;                            node.setScaleY(1.5);&#10;                        });&#10;                        node.setOnMouseExited(e -&gt; {&#10;                            node.setStyle(&quot;&quot;);&#10;                            node.setScaleX(1.0);&#10;                            node.setScaleY(1.0);&#10;                        });&#10;                    }&#10;                }&#10;            }&#10;        }&#10;&#10;        // Tùy chỉnh style cho LineChart&#10;        chartDoanhThu.setCreateSymbols(true);&#10;        chartDoanhThu.setLegendVisible(true);&#10;    }&#10;&#10;    /**&#10;     * ==================== BIỂU ĐỒ TOP SẢN PHẨM ====================&#10;     * Load biểu đồ top sản phẩm bán chạy&#10;     */&#10;    private void loadTopProductsChart() {&#10;        if (chartTopSanPham == null) return;&#10;&#10;        try {&#10;            // *** CHỈNH SỐ SẢN PHẨM: Thay đổi số 5 để hiển thị nhiều/ít sản phẩm hơn ***&#10;            Map&lt;String, Integer&gt; topProducts = thongKeTrangChinhDAO.getTopSanPhamBanChay(5);&#10;&#10;            XYChart.Series&lt;String, Number&gt; series = new XYChart.Series&lt;&gt;();&#10;            series.setName(&quot;Số lượng bán&quot;);&#10;&#10;            // Map để lưu tên đầy đủ của thuốc&#10;            Map&lt;String, String&gt; fullNamesMap = new java.util.HashMap&lt;&gt;();&#10;&#10;            for (Map.Entry&lt;String, Integer&gt; entry : topProducts.entrySet()) {&#10;                String tenThuocDayDu = entry.getKey();&#10;                String tenThuoc = tenThuocDayDu;&#10;&#10;                // *** CHỈNH ĐỘ DÀI TÊN: Thay đổi số 15 (độ dài tối đa) và 12 (độ dài cắt) ***&#10;                // Rút ngắn tên thuốc nếu quá dài&#10;                if (tenThuoc.length() &gt; 15) {&#10;                    tenThuoc = tenThuoc.substring(0, 12) + &quot;...&quot;;&#10;                }&#10;&#10;                // Lưu tên đầy đủ&#10;                fullNamesMap.put(tenThuoc, tenThuocDayDu);&#10;&#10;                XYChart.Data&lt;String, Number&gt; data = new XYChart.Data&lt;&gt;(tenThuoc, entry.getValue());&#10;                series.getData().add(data);&#10;            }&#10;&#10;            chartTopSanPham.getData().clear();&#10;            chartTopSanPham.getData().add(series);&#10;&#10;            // Thêm tooltip cho từng thanh trong biểu đồ&#10;            for (XYChart.Data&lt;String, Number&gt; data : series.getData()) {&#10;                String tenThuocHienThi = data.getXValue();&#10;                String tenThuocDayDu = fullNamesMap.getOrDefault(tenThuocHienThi, tenThuocHienThi);&#10;                int soLuong = data.getYValue().intValue();&#10;&#10;                javafx.scene.control.Tooltip tooltip = new javafx.scene.control.Tooltip(&#10;                        &quot;Thuốc: &quot; + tenThuocDayDu + &quot;\n&quot; +&#10;                                &quot;Số lượng bán: &quot; + formatter.format(soLuong)&#10;                );&#10;&#10;                // *** CHỈNH MÀU TOOLTIP: Thay đổi màu nền và màu chữ ***&#10;                tooltip.setShowDelay(javafx.util.Duration.millis(100));&#10;                tooltip.setStyle(&#10;                        &quot;-fx-font-size: 12px; &quot; +&#10;                                &quot;-fx-background-color: #1e3a8a; &quot; +    // Màu nền tooltip (xanh lá)&#10;                                &quot;-fx-text-fill: white;&quot;                 // Màu chữ tooltip (trắng)&#10;                );&#10;&#10;                // Gắn tooltip vào node của data point (thanh)&#10;                javafx.scene.Node node = data.getNode();&#10;                if (node != null) {&#10;                    javafx.scene.control.Tooltip.install(node, tooltip);&#10;&#10;                    // *** CHỈNH HIỆU ỨNG HOVER: Thay đổi độ mờ khi rê chuột ***&#10;                    node.setOnMouseEntered(e -&gt; {&#10;                        node.setStyle(&#10;                                &quot;-fx-cursor: hand; &quot; +&#10;                                        &quot;-fx-opacity: 0.8;&quot;             // Độ mờ khi hover (0.0 - 1.0)&#10;                        );&#10;                    });&#10;                    node.setOnMouseExited(e -&gt; {&#10;                        node.setStyle(&quot;-fx-opacity: 1.0;&quot;);&#10;                    });&#10;                }&#10;            }&#10;&#10;        } catch (Exception e) {&#10;            System.err.println(&quot;Error loading top products chart: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    private void loadTableData() {&#10;        ArrayList&lt;ThongKeDoanhThu&gt; dsThongKe = thongKeDAO.getDoanhThuTheoThoiGian(tuNgay, denNgay, selectedNhanVien);&#10;        ObservableList&lt;ThongKeDoanhThu&gt; data = FXCollections.observableArrayList(dsThongKe);&#10;        tableChiTiet.setItems(data);&#10;    }&#10;&#10;    &#10;//    Xuất báo cáo thống kê doanh thu ra file CSV&#10;    private void xuatBaoCao() {&#10;        try {&#10;            // Tạo FileChooser để chọn nơi lưu file&#10;            FileChooser fileChooser = new FileChooser();&#10;            fileChooser.setTitle(&quot;Xuất báo cáo thống kê doanh thu&quot;);&#10;            fileChooser.setInitialFileName(&quot;BaoCaoDoanhThu_&quot; + LocalDate.now().format(DateTimeFormatter.ofPattern(&quot;ddMMyyyy&quot;)) + &quot;.csv&quot;);&#10;&#10;            // Thiết lập filter cho file CSV&#10;            FileChooser.ExtensionFilter extFilter = new FileChooser.ExtensionFilter(&quot;CSV files (*.csv)&quot;, &quot;*.csv&quot;);&#10;            fileChooser.getExtensionFilters().add(extFilter);&#10;&#10;            // Hiển thị dialog để chọn nơi lưu&#10;            File file = fileChooser.showSaveDialog(btnXuatBaoCao.getScene().getWindow());&#10;&#10;            if (file != null) {&#10;                // Xuất dữ liệu ra file CSV&#10;                exportToCSV(file);&#10;&#10;                // Hiển thị thông báo thành công&#10;                Alert alert = new Alert(Alert.AlertType.INFORMATION);&#10;                alert.setTitle(&quot;Xuất báo cáo thành công&quot;);&#10;                alert.setHeaderText(null);&#10;                alert.setContentText(&quot;Báo cáo đã được xuất thành công!\nĐường dẫn: &quot; + file.getAbsolutePath());&#10;                alert.showAndWait();&#10;            }&#10;        } catch (Exception e) {&#10;            // Hiển thị thông báo lỗi&#10;            Alert alert = new Alert(Alert.AlertType.ERROR);&#10;            alert.setTitle(&quot;Lỗi xuất báo cáo&quot;);&#10;            alert.setHeaderText(null);&#10;            alert.setContentText(&quot;Có lỗi xảy ra khi xuất báo cáo: &quot; + e.getMessage());&#10;            alert.showAndWait();&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;//    Xuất dữ liệu thống kê doanh thu ra file CSV&#10;    private void exportToCSV(File file) throws IOException {&#10;        // Kiểm tra xem có phải hiển thị theo tháng không&#10;        String thoiGian = cmbThoiGian.getValue();&#10;        boolean hienThiTheoThang = &quot;Năm nay&quot;.equals(thoiGian);&#10;&#10;        // Lấy dữ liệu&#10;        ArrayList&lt;ThongKeDoanhThu&gt; dsThongKe;&#10;        if (hienThiTheoThang) {&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThang(tuNgay, denNgay, selectedNhanVien);&#10;        } else {&#10;            dsThongKe = thongKeDAO.getDoanhThuTheoThoiGian(tuNgay, denNgay, selectedNhanVien);&#10;        }&#10;&#10;        // Tạo FileWriter với UTF-8 BOM để Excel hiển thị đúng tiếng Việt&#10;        try (FileWriter writer = new FileWriter(file)) {&#10;            // Thêm UTF-8 BOM&#10;            writer.write('\ufeff');&#10;&#10;            // Ghi header thông tin báo cáo&#10;            writer.append(&quot;BAO CAO THONG KE DOANH THU\n&quot;);&#10;            writer.append(&quot;Thoi gian: &quot;).append(thoiGian).append(&quot;\n&quot;);&#10;            writer.append(&quot;Tu ngay: &quot;).append(tuNgay.format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;))).append(&quot;\n&quot;);&#10;            writer.append(&quot;Den ngay: &quot;).append(denNgay.format(DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;))).append(&quot;\n&quot;);&#10;&#10;            String nhanVienText = selectedNhanVien != null ? selectedNhanVien : &quot;Tat ca&quot;;&#10;            writer.append(&quot;Nhan vien: &quot;).append(nhanVienText).append(&quot;\n&quot;);&#10;            writer.append(&quot;\n&quot;);&#10;&#10;            // Ghi thông tin tổng quan&#10;            writer.append(&quot;THONG TIN TONG QUAN\n&quot;);&#10;            double tongDoanhThu = thongKeDAO.getTongDoanhThu(tuNgay, denNgay, selectedNhanVien);&#10;            int tongDonHang = thongKeDAO.getTongDonHang(tuNgay, denNgay, selectedNhanVien);&#10;            int soKhachHang = thongKeDAO.getSoKhachHangMoi(tuNgay, denNgay, selectedNhanVien);&#10;            double donHangTB = tongDonHang &gt; 0 ? tongDoanhThu / tongDonHang : 0;&#10;&#10;            writer.append(&quot;Tong doanh thu,&quot;).append(String.format(&quot;%.2f&quot;, tongDoanhThu)).append(&quot; VND\n&quot;);&#10;            writer.append(&quot;Tong don hang,&quot;).append(String.valueOf(tongDonHang)).append(&quot;\n&quot;);&#10;            writer.append(&quot;Don hang trung binh,&quot;).append(String.format(&quot;%.2f&quot;, donHangTB)).append(&quot; VND\n&quot;);&#10;            writer.append(&quot;So khach hang,&quot;).append(String.valueOf(soKhachHang)).append(&quot;\n&quot;);&#10;            writer.append(&quot;\n&quot;);&#10;&#10;            // Ghi header cho bảng chi tiết&#10;            writer.append(&quot;CHI TIET DOANH THU\n&quot;);&#10;            if (hienThiTheoThang) {&#10;                writer.append(&quot;Thang,So don hang,Doanh thu (VND),Don hang TB (VND),Khach hang moi,Nhan vien ban\n&quot;);&#10;            } else {&#10;                writer.append(&quot;Ngay,So don hang,Doanh thu (VND),Don hang TB (VND),Khach hang moi,Nhan vien ban\n&quot;);&#10;            }&#10;&#10;            // Ghi dữ liệu chi tiết&#10;            DateTimeFormatter dateFormatter = hienThiTheoThang&#10;                ? DateTimeFormatter.ofPattern(&quot;MM/yyyy&quot;)&#10;                : DateTimeFormatter.ofPattern(&quot;dd/MM/yyyy&quot;);&#10;&#10;            for (ThongKeDoanhThu tk : dsThongKe) {&#10;                writer.append(tk.getNgay().format(dateFormatter)).append(&quot;,&quot;);&#10;                writer.append(String.valueOf(tk.getSoDonHang())).append(&quot;,&quot;);&#10;                writer.append(String.format(&quot;%.2f&quot;, tk.getDoanhThu())).append(&quot;,&quot;);&#10;                writer.append(String.format(&quot;%.2f&quot;, tk.getDonHangTB())).append(&quot;,&quot;);&#10;                writer.append(String.valueOf(tk.getKhachHangMoi())).append(&quot;,&quot;);&#10;                writer.append(tk.getNhanVienBan() != null ? tk.getNhanVienBan() : &quot;&quot;).append(&quot;\n&quot;);&#10;            }&#10;&#10;            writer.append(&quot;\n&quot;);&#10;&#10;            // Ghi top sản phẩm bán chạy&#10;            writer.append(&quot;TOP SAN PHAM BAN CHAY\n&quot;);&#10;            writer.append(&quot;Ten thuoc,So luong ban\n&quot;);&#10;&#10;            Map&lt;String, Integer&gt; topSanPham = thongKeDAO.getTopSanPhamBanChay(tuNgay, denNgay, 5);&#10;            for (Map.Entry&lt;String, Integer&gt; entry : topSanPham.entrySet()) {&#10;                writer.append(entry.getKey()).append(&quot;,&quot;);&#10;                writer.append(String.valueOf(entry.getValue())).append(&quot;\n&quot;);&#10;            }&#10;&#10;            writer.flush();&#10;        }&#10;    }&#10;&#10;//    Định dạng số tiền với đơn vị K, M, B&#10;    private String formatCurrency(double amount) {&#10;        if (amount &gt;= 1_000_000_000) {&#10;            return percentFormatter.format(amount / 1_000_000_000) + &quot;B&quot;;&#10;        } else if (amount &gt;= 1_000_000) {&#10;            return percentFormatter.format(amount / 1_000_000) + &quot;M&quot;;&#10;        } else if (amount &gt;= 1_000) {&#10;            return percentFormatter.format(amount / 1_000) + &quot;K&quot;;&#10;        }&#10;        return formatter.format(amount);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>